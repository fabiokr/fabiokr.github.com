
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Fabio Kreusch</title>
  <meta name="author" content="Fabio Kreusch">

  
  <meta name="description" content="Ansible is an IT orchestration tool I&#8217;ve been playing with lately. Similar tools include Chef and Puppet. Some cools things about Ansible is &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.kreusch.com.br/blog/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Fabio Kreusch" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-7244289-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Fabio Kreusch</a></h1>
  
    <h2>Personal page</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.kreusch.com.br" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/03/manage-a-development-machine-with-ansible/">Manage a Development Machine With Ansible</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-03T21:11:00-02:00" pubdate data-updated="true">Dec 3<span>rd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.ansibleworks.com">Ansible</a> is an IT orchestration tool I&#8217;ve been playing with lately. Similar tools include <a href="http://www.opscode.com/chef/">Chef</a> and <a href="http://puppetlabs.com">Puppet</a>. Some cools things about Ansible is that it is open source, and you don&#8217;t need anything in your target machine (it just uses an ssh connection).</p>

<p>In this quickstart, I&#8217;ll build an Ansible playbook to manage a personal Ubuntu desktop.</p>

<p>First step is to install Ansible. For Ubuntu, a repository is available:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo add-apt-repository ppa:rquillo/ansible
</span><span class='line'>$ sudo apt-get update
</span><span class='line'>$ sudo apt-get install ansible</span></code></pre></td></tr></table></div></figure>


<p>Additional installation methods can be found in <a href="http://ansibleworks.com/docs/intro_installation.html">this page</a>.</p>

<p>Now, we create a directory that will hold our playbook:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir my_playbook</span></code></pre></td></tr></table></div></figure>


<p>A playbook is the source of instructions that ansible will run when provisioning.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ touch playbook.yml</span></code></pre></td></tr></table></div></figure>


<p>Ansible expects instructions in the <code>yml</code> format. Lets populate our playbook with an initial content:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>---
</span><span class='line'># the host in which the playbook will be run
</span><span class='line'>- hosts: localhost
</span><span class='line'>  # in this example, we using a localhost, so this is needed
</span><span class='line'>  connection: local
</span><span class='line'>
</span><span class='line'>  # the target user Ansible will impersonate when provisioning
</span><span class='line'>  user: johndoe
</span><span class='line'>
</span><span class='line'>  # this makes all tasks run with sudo by default
</span><span class='line'>  sudo: true
</span><span class='line'>
</span><span class='line'>  # additional variables
</span><span class='line'>  vars:
</span><span class='line'>    user: johndoe
</span><span class='line'>
</span><span class='line'>  # roles are a way to group tasks; they will run in the sequence determined here
</span><span class='line'>  roles:
</span><span class='line'>    - system</span></code></pre></td></tr></table></div></figure>


<p>The next step is to create an inventory file. This will hold a list of servers Ansible can run with:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ touch inventory
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>localhost   ansible_connection=local</span></code></pre></td></tr></table></div></figure>


<p>Now, lets create our roles. For this example, the idea is to have a <code>system</code> role that is responsible for setting up system libraries.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir roles
</span><span class='line'>$ mkdir roles/system</span></code></pre></td></tr></table></div></figure>


<p>And our system main task:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ touch roles/system/main.yml</span></code></pre></td></tr></table></div></figure>


<p>And this is the content of our sytems task:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>---
</span><span class='line'>
</span><span class='line'># This is a task. Basically, it needs a module command. In this example, it
</span><span class='line'># also have a `name`, which will be displayed while running the task to give a
</span><span class='line'># better description of the running task.
</span><span class='line'>- name: install
</span><span class='line'>  # apt is our module. It installs debian packages. Here we are passing an
</span><span class='line'>  # `` variable, which is the item from `with_items`
</span><span class='line'>  apt: pkg=
</span><span class='line'>  # `with_items` will loop through a list and run the module passing each item
</span><span class='line'>  # as ``
</span><span class='line'>  with_items:
</span><span class='line'>    # better shell
</span><span class='line'>    - zsh
</span><span class='line'>    # terminal multiplexer
</span><span class='line'>    - tmux
</span><span class='line'>    # terminal editor
</span><span class='line'>    - vim-gtk
</span><span class='line'>    # shh
</span><span class='line'>    - ssh
</span><span class='line'>    # ruby
</span><span class='line'>    - ruby
</span><span class='line'>    # ruby dev headers
</span><span class='line'>    - ruby-dev
</span><span class='line'>    # ruby package manager
</span><span class='line'>    - rubygems
</span><span class='line'>
</span><span class='line'># This is an example of how to gather information from the machine. We
</span><span class='line'># run a command with the "shell" module and register the result into the
</span><span class='line'># "default_shell" variable
</span><span class='line'>- name: zsh facts
</span><span class='line'>  shell: 'echo $SHELL'
</span><span class='line'>  register: default_shell
</span><span class='line'>  # changed when determines when will this task be considered changed when running
</span><span class='line'>  # ansible. In this case, we want it to always be false, as we are just
</span><span class='line'>  # retrieving information.
</span><span class='line'>  changed_when: False
</span><span class='line'>  sudo: no
</span><span class='line'>
</span><span class='line'># Now, we want to set zsh as the default shell, unless it is already the default
</span><span class='line'># one.
</span><span class='line'>- name: make zsh default
</span><span class='line'>  shell:  chsh -s /bin/zsh 
</span><span class='line'>  # This task will run only when the following is true. In here, we check the
</span><span class='line'>  # value registered previously within the "default_shell" variable.
</span><span class='line'>  when: default_shell.stdout.find('/bin/zsh') == -1</span></code></pre></td></tr></table></div></figure>


<p>Now, to run our playbook:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ansible-playbook -K -i inventory playbook.yml</span></code></pre></td></tr></table></div></figure>


<p><code>-K</code> will ask for the machine sudo password. <code>-i</code> will pass the inventory file to use.</p>

<p>For additional modules, look into the <a href="http://www.ansibleworks.com/docs/modules.html">Ansible modules documentation</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/01/vagrant-sshfs/">Vagrant SSHFS Plugin</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-01T20:50:00-02:00" pubdate data-updated="true">Dec 1<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://vagrantup.com/">Vagrant</a> supports NFS by default to mount host directories in the client machine. In some situations that won&#8217;t work well, so I developed an <a href="https://github.com/fabiokr/vagrant-sshfs">SSH file system</a> plugin for it.</p>

<p>Basically, you have to install it and configure the mounted folders:</p>

<p><code>vagrant plugin install vagrant-sshfs</code></p>

<p>In the <code>VagrantFile</code>:</p>

<p><code>config.sshfs.paths = { "src" =&gt; "mountpoint" }</code></p>

<p>That will mount the <code>src</code> folder in the virtual box into the <code>mountpoint</code> folder in the host machine.</p>

<p>More information is available in the plugin <a href="https://github.com/fabiokr/vagrant-sshfs">README</a> file.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/01/sublime-related-files/">Sublime Related Files Plugin</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-01T20:33:00-02:00" pubdate data-updated="true">Dec 1<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://github.com/fabiokr/sublime-related-files">Sublime Related Files</a> is a <a href="http://www.sublimetext.com/">SublimeText</a> plugin that displays a list of related files for your currently opened file.</p>

<p>For example, a source code file could be related to its unit test file.</p>

<p>It comes precofigured for a <a href="https://github.com/fabiokr/sublime-related-files/blob/master/RelatedFiles.sublime-settings">Rails project</a>, so it will display related test/spec files, views, controllers, helpers and routes, and you can easily add your own setup.</p>

<p>You can easily install it through the <a href="https://sublime.wbond.net/">Sublime Package Manager</a>.</p>

<p><img src="https://raw.github.com/fabiokr/sublime-related-files/master/screenshots/list.png" alt="Screenshot" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/03/20/uninstall-all-gems-in-ruby20/">Uninstall All Gems in Ruby 2.0</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-20T10:40:00-03:00" pubdate data-updated="true">Mar 20<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Here is a command to uninstall all non default gems in Ruby 2.0:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem list | cut -d" " -f1 | grep -v "test-unit\|psych\|minitest\|io-console\|rdoc\|bigdecimal\|rake\|json"  | xargs gem uninstall -aIx</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/09/19/record-a-screen-cast-to-a-gif-file/">Record a Screen Cast to a Gif File</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-19T15:08:00-03:00" pubdate data-updated="true">Sep 19<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Here is a simple shell script that converts a recorded ogv file to an animated gif, pretty useful for demonstrating small interactions. For recording an ogv, I&#8217;ve been using Record my Desktop on Ubuntu. You&#8217;ll also need mplayer, and imagemagick. Under Ubuntu/Debian, you can install those with this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>apt-get install imagemagick mplayer gtk-recordmydesktop</span></code></pre></td></tr></table></div></figure>


<p>And here is the shell script:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>ogv_to_gif<span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="c"># Export into images</span>
</span><span class='line'>  mplayer -ao null <span class="nv">$1</span> -vo jpeg:outdir<span class="o">=</span>/tmp/ogv_to_gif
</span><span class='line'>
</span><span class='line'>  <span class="c"># Convert images to animated gif</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;Converting images folder to gif...&quot;</span>
</span><span class='line'>  convert /tmp/ogv_to_gif/* /tmp/ogv_to_gif.gif
</span><span class='line'>
</span><span class='line'>  <span class="c"># Final filename</span>
</span><span class='line'>  <span class="nv">original_filename</span><span class="o">=</span><span class="nv">$1</span>
</span><span class='line'>  <span class="nv">filename</span><span class="o">=</span><span class="k">${</span><span class="nv">original_filename</span><span class="p">//ogv/gif</span><span class="k">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># Optimize gif</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;Optimizing generated gif...&quot;</span>
</span><span class='line'>  convert /tmp/ogv_to_gif.gif -fuzz 10% -layers Optimize <span class="s2">&quot;$filename&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># Cleans up tmp folders</span>
</span><span class='line'>  rm -rf /tmp/ogv_to_gif.gif /tmp/ogv_to_gif
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p> </p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/09/12/jquery-silently-fails-on-ajax-errors/">Jquery Silently Fails on Ajax Errors</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-12T18:38:00-03:00" pubdate data-updated="true">Sep 12<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Context: you have an ajax call that returns javascript code. If that javascript raises a runtime error, it turns out that Jquery will engulf it and you will have a hard time finding out what is failling.</p>

<p>This is what I came up with to force raising when that kind of thing happens:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">$</span> <span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">on</span> <span class="s">&quot;ajax:error&quot;</span><span class="p">,</span> <span class="nf">(e, xhr, data, error) -&gt;</span>
</span><span class='line'>  <span class="err"> </span> <span class="k">throw</span> <span class="nx">error</span>
</span></code></pre></td></tr></table></div></figure>


<p>Code is in Coffeescript, by the way.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/05/guake-autostart-script-with-rails/">Guake Autostart Script With Rails</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-05T17:23:00-03:00" pubdate data-updated="true">Jul 5<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I use
<a href="http://guake.org/">Guake</a> terminal in my development
<a href="http://www.ubuntu.com">Ubuntu</a> machine, and most of the time I find myself repeating a ton of commands to start my Rails devlopment environment, each process under its own tab. So today I finally took some time to setup a simple script that sets up Guake the way I want it. By adding something like the following to your .bashrc file, you&#8217;ll be able to start it by running the &#8220;guake-my-project&#8221; command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>guake-my-project() {  
</span><span class='line'>    guake --rename-tab=Specs" --execute-command="cd ~/path/to/project && bundle exec guard" &&  
</span><span class='line'>    guake --new-tab=2 --rename-tab="Server" --execute-command="cd ~/path/to/project && rails s" &&  
</span><span class='line'>    guake --new-tab=3 --rename-tab="MyProject" --execute-command="cd ~/path/to/project";
</span><span class='line'>  }</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/01/13/notifying-delayed-job-failures-by-default/">Notifying Delayed_job Failures by Default</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-13T12:35:00-02:00" pubdate data-updated="true">Jan 13<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Here is a helpful code snippet to notify delayed_job errors by default in a Rails application. In a config/initializers file, add the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Optional but recommended for less future surprises.</span>
</span><span class='line'><span class="c1"># Fail at startup if method does not exist instead of in background job </span>
</span><span class='line'><span class="o">[[</span><span class="no">Airbrake</span><span class="p">,</span> <span class="ss">:notify</span><span class="o">]].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">object</span><span class="p">,</span> <span class="n">method_name</span><span class="o">|</span>
</span><span class='line'><span class="err"> </span> <span class="k">raise</span> <span class="no">NoMethodError</span><span class="p">,</span> <span class="s2">&quot;undefined method `</span><span class="si">#{</span><span class="n">method_name</span><span class="si">}</span><span class="s2">&#39; for </span><span class="si">#{</span><span class="n">object</span><span class="o">.</span><span class="n">inspect</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">unless</span> <span class="n">object</span><span class="o">.</span><span class="n">respond_to?</span><span class="p">(</span><span class="n">method_name</span><span class="p">,</span> <span class="kp">true</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Chain delayed job&#39;s handle_failed_job method to do exception notification</span>
</span><span class='line'><span class="ss">Delayed</span><span class="p">:</span><span class="ss">:Worker</span><span class="o">.</span><span class="n">class_eval</span> <span class="k">do</span><span class="err"> </span>
</span><span class='line'><span class="err"> </span> <span class="k">def</span> <span class="nf">handle_failed_job_with_notification</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</span><span class='line'><span class="err"> </span> <span class="err"> </span> <span class="n">handle_failed_job_without_notification</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="err"> </span> <span class="err"> </span> <span class="c1"># only actually send mail in production</span>
</span><span class='line'><span class="err"> </span> <span class="err"> </span> <span class="k">if</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">production?</span>
</span><span class='line'><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1"># rescue if ExceptionNotifier fails for some reason</span>
</span><span class='line'><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">begin</span>
</span><span class='line'><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="no">Airbrake</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</span><span class='line'><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span> <span class="s2">&quot;Airbrake failed: </span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="n">backtrace</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
</span><span class='line'><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span> <span class="s2">&quot;  </span><span class="si">#{</span><span class="n">f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">flush</span>
</span><span class='line'><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">end</span>
</span><span class='line'><span class="err"> </span> <span class="err"> </span> <span class="k">end</span>
</span><span class='line'><span class="err"> </span> <span class="k">end</span><span class="err"> </span>
</span><span class='line'>
</span><span class='line'><span class="err"> </span> <span class="n">alias_method_chain</span> <span class="ss">:handle_failed_job</span><span class="p">,</span> <span class="ss">:notification</span><span class="err"> </span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this example, Airbrake is being used for error notification, but this can be easily changed to the desired notification method.</p>

<p>Credits to this thread: 
<a href="http://stackoverflow.com/questions/5972903/how-to-make-exceptionnotifier-work-with-delayed-job-in-rails-3">http://stackoverflow.com/questions/5972903/how-to-make-exceptionnotifier-work-with-delayed-job-in-rails-3</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/08/23/manageable-content-rails-3-1-content-management-engine/">Manageable Content - Rails 3.1 Content Management Engine</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-23T23:37:00-03:00" pubdate data-updated="true">Aug 23<span>rd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hi there!</p>

<p>This is a tutorial post about a gem I have just released:
<a href="https://github.com/fabiokr/manageable_content">manageable_content</a>. It is a content management framework for Rails 3.1. It provides a basic mapping between controllers to manageable contents. More detailed info can be found on the
<a href="https://github.com/fabiokr/manageable_content/blob/master/README.rdoc">README</a> file.</p>

<p>In this post, I&#8217;ll show how to create a new Rails project using the engine. The full example is available in
<a href="https://github.com/fabiokr/manageable_content_example_app">Github</a>. So, let the fun begin!</p>

<p>The first step is to create a new Rails app. Right now the engine requires Rails 3.1, so be sure to have it installed:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails new manageable_content_example_app</span></code></pre></td></tr></table></div></figure>


<p>So, the ideia of the website is to allow each page to have its own title in a manageable way. We will also have two controllers, Home and Contact. Home controller will have a body content, and Contact will have a body and a side content. Also, we need a content for the footer that will be shared across all pages. </p>

<p>Let&#8217;s generate our controllers first:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails g controller home index --no-helper
</span><span class='line'>rails g controller contact index --no-helper</span></code></pre></td></tr></table></div></figure>


<p>In
<a href="https://github.com/fabiokr/manageable_content_example_app/commit/c90fae643a6dc778d6b744487b6f9abe81f8c7c9">this commit</a> I have added sample contents so that you can see which contents we want to be manageable.</p>

<p>Ok, now we need to add manageable_content to our Gemfile. This line needs to be added:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;manageable_content&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then, run the &#8216;bundle&#8217; command to install it. After that, we need to import and run the engine migrations:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rake</span> <span class="n">manageable_content_engine</span><span class="ss">:install:migrations</span>
</span><span class='line'><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="n">migrate</span>
</span></code></pre></td></tr></table></div></figure>


<p>The next step is to make the engine Dsl available for our controllers. We need to add this to our application_controller:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="kp">include</span> <span class="ss">ManageableContent</span><span class="p">:</span><span class="ss">:Controllers</span><span class="o">::</span><span class="no">Dsl</span>
</span></code></pre></td></tr></table></div></figure>


<p>We will start with our title content. Let&#8217;s make the title content manageable for all controllers in our website by adding this to our application_controller:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">manageable_content_for</span> <span class="ss">:title</span>
</span></code></pre></td></tr></table></div></figure>


<p> 
Now run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rake</span> <span class="n">manageable_content</span><span class="ss">:generate</span>
</span></code></pre></td></tr></table></div></figure>


<p>This command will generate our contents in the database based on our controllers configurations. We should than use the engine helper to print the manageable content in our views. You can see how I have done that in
<a href="https://github.com/fabiokr/manageable_content_example_app/commit/340b254aa6f2cd4e41b022f398f01f6f8e783609">this commit</a>. Now, we need a place in which we can edit our manageable contents. In
<a href="https://github.com/fabiokr/manageable_content_example_app/commit/702b4cd266e33d24ff5d25ca13a7c5b075ecf206">this commit</a> and in
<a href="https://github.com/fabiokr/manageable_content_example_app/commit/4c6f599b9c9ec8b973e57cfd13638d8915f703d4">this one</a> I created a basic administration page to manage the pages. An important thing to remeber is that the admin controller should inherit from a controller different that the application_controller, otherwise your admin controller will have manageable contents too!</p>

<p>Now, by accessing the admin page and saving some title contents, if we access our website pages their titles should be using the manageable contents. In our pages admin, you can notice that there was a page for our home controller, contact controller and for the application controller. To use the application controller title in our views, we have to use the manageable_layout_content_for helper. Check
<a href="https://github.com/fabiokr/manageable_content_example_app/commit/f1043c56d2923b0c4eb07e24f7c0b7fdfc0816a7">this commit</a>.</p>

<p>We can also have content that will be shared by all pages. In our website, the &#8216;footer&#8217; content has to be like that. On our application_controller, we add this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">manageable_layout_content_for</span><span class="err"> </span><span class="ss">:footer</span>
</span></code></pre></td></tr></table></div></figure>


<p>Than, after generating our contents with &#8216;bundle exec rake manageable_content:generate&#8217;, the footer content should be list under the &#8216;application&#8217; page on our admin. To use it in our views, just add this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">manageable_layout_content_for</span><span class="err"> </span><span class="ss">:footer</span>
</span></code></pre></td></tr></table></div></figure>


<p>The commit for this step is
<a href="https://github.com/fabiokr/manageable_content_example_app/commit/5352ca2cb8d4483243c78d2abec0586a4e6adfd8">this one</a>.</p>

<p>To finish this example, we will add contents that will be specific to our home and contact controller. Home controller will have a body content, and contact will have a body and a side content. Add this to the controllers:</p>

<p>home_controller:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">manageable_content_for</span><span class="err"> </span><span class="ss">:body</span>
</span></code></pre></td></tr></table></div></figure>


<p>contact_controller:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">manageable_content_for</span><span class="err"> </span><span class="ss">:body</span><span class="p">,</span><span class="err"> </span><span class="ss">:side</span>
</span></code></pre></td></tr></table></div></figure>


<p>After generating the contents, we can manage them thought the admin interface, and use them in our views with the helper, as you can
<a href="https://github.com/fabiokr/manageable_content_example_app/commit/633022f5d4d45d3e3735556caae80045b65098bd">see here.</a></p>

<p>So basically, that&#8217;s it!</p>

<pre><code>The ideia was to create a simple to use and generic content manager for Rails. The source code is available in
</code></pre>

<p><a href="https://github.com/fabiokr/manageable_content">GIthub</a> and it is open for collaboration.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/10/09/rightjs-growl-notification-widget/">RightJS Growl Notification Widget</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-09T00:00:00-03:00" pubdate data-updated="true">Oct 9<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hi there!</p>

<p>I&#8217;m experimenting with
<a href="http://rightjs.org/">RightJS</a> on some personal projects, and I&#8217;m starting to like it!</p>

<p>I have also developed my first Widget, a Growl like notification. It is based on
<a href="http://code.google.com/p/jquery-purr/">Jquery-purr</a> plugin, and I have ported it to RightJS. It&#8217;s freely available on
<a href="http://github.com/fabiokr/rightjs-growl">Github</a>.</p>

<p>I must do some tests on IE, but for now it&#8217;s functional on Firefox and Chrome (the ones I have tested).</p>

<p>Until next time!</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/12/03/manage-a-development-machine-with-ansible/">Manage a development machine with Ansible</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/01/vagrant-sshfs/">Vagrant SSHFS plugin</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/01/sublime-related-files/">Sublime Related Files plugin</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/20/uninstall-all-gems-in-ruby20/">Uninstall all gems in Ruby 2.0</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/19/record-a-screen-cast-to-a-gif-file/">Record a screen cast to a gif file</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/fabiokr">@fabiokr</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'fabiokr',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("fabiokr", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/fabiokr" class="twitter-follow-button" data-show-count="false">Follow @fabiokr</a>
  
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  This work by <a href="">Fabio Kreusch</a> is licensed under a <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 Unported License</a> (2013).
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
